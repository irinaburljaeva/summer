<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ü—Ä–æ–∫–∞–∑—ã —Å –ø–∞—Å—Ç–æ–π</title>
  <style>
    body { background:white; margin:0; font-family:Arial,sans-serif; text-align:center; overflow:hidden; }
    .top-bar { position:absolute; top:10px; width:100%; display:flex; justify-content:space-between; padding:0 20px; font-weight:bold; font-size:18px; z-index:5; }
    #record { position:absolute; top:10px; left:20px; background:#eee; padding:6px 12px; border-radius:8px; }
    #counter { position:absolute; top:10px; right:20px; background:#CF2C02; color:white; padding:8px 12px; border-radius:8px; }
    .hidden { display:none; }
    .toothpaste-img { width:220px; cursor:pointer; user-select:none; -webkit-user-drag:none; outline:none; }
    .shake { animation:shake 0.3s; }
    @keyframes shake { 0%{transform:translate(0)rotate(0);}25%{transform:translate(-5px)rotate(-5deg);}50%{transform:translate(5px)rotate(5deg);}75%{transform:translate(-5px)rotate(-5deg);}100%{transform:translate(0)rotate(0);} }
    .message { font-size:18px; margin-top:20px; opacity:0; animation:fadeIn 0.5s forwards; }
    @keyframes fadeIn { to{opacity:1;} }
    video { width:220px; display:none; }
    .pink-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:#FFD6E7; opacity:0; z-index:10; transition:opacity 1s ease-in-out; }
    .pink-overlay.show { opacity:1; }
    .final-text { position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:white; padding:20px; border-radius:12px; font-size:20px; z-index:11; display:none; }
    .reset-btn { margin-top:15px; padding:10px 15px; background:#CF2C02; color:white; border:none; border-radius:8px; font-size:16px; cursor:pointer; }
    .emoji { position:absolute; font-size:30px; opacity:0; animation:emojiPop 1s forwards; }
    @keyframes emojiPop { 0%{transform:scale(0);opacity:0;}50%{transform:scale(1.3);opacity:1;}100%{transform:scale(1);opacity:1;} }
  </style>
</head>
<body>
  <div class="top-bar">
    <div id="record" class="hidden">–†–µ–∫–æ—Ä–¥: 0</div>
    <div id="counter" class="hidden">–ü—Ä–æ–∫–∞–∑—ã —Å –ø–∞—Å—Ç–æ–π: 0</div>
  </div>

  <div id="content">
    <img id="tube" src="intro.jpg" class="toothpaste-img" />
    <video id="explosionVideo">
      <source src="toothpaste.mp4" type="video/mp4">
    </video>
    <div id="message" class="message"></div>
  </div>

  <div id="pinkOverlay" class="pink-overlay"></div>
  <div id="finalText" class="final-text">
    <p>–û–π! –ö—Ç–æ-—Ç–æ –ø–µ—Ä–µ—É—Å–µ—Ä–¥—Å—Ç–≤–æ–≤–∞–ª üòÖ</p>
    <button id="resetBtn" class="reset-btn">–°—Ç–µ—Ä–µ—Ç—å –ø–∞—Å—Ç—É</button>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
  <script>
    const tube=document.getElementById("tube");
    const video=document.getElementById("explosionVideo");
    const messageEl=document.getElementById("message");
    const counterEl=document.getElementById("counter");
    const recordEl=document.getElementById("record");
    const pinkOverlay=document.getElementById("pinkOverlay");
    const finalText=document.getElementById("finalText");
    const resetBtn=document.getElementById("resetBtn");

    const messages=[
      "–ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ –≤–∏–¥–µ–ª –≤—ã –Ω–∞–º–∞–∑–∞–ª–∏ –ø–∞—Å—Ç–æ–π —Ç—Ä–µ–Ω–µ—Ä–∞ –ù–∞—Å—Ç—é üòâ",
      "–®–∞–ª–æ—Å—Ç—å —É–¥–∞–ª–∞—Å—å! –í—ã –∏–∑–º–∞–∑–∞–ª–∏ –ø–∞—Å—Ç–æ–π –≤–∞—à–µ–≥–æ —Å–æ—Å–µ–¥–∞ üòÅ",
      "–í—ã –∏–∑–º–∞–∑–∞–ª–∏ –ø–∞—Å—Ç–æ–π –∫—É—Ä–∞—Ç–æ—Ä–∞ –°–∞—à—É üòÖ",
      "–ö–∞–∂–µ—Ç—Å—è –∫—Ç–æ-—Ç–æ –∏–∑–º–∞–∑–∞–ª –ø–∞—Å—Ç–æ–π —Ç—Ä–µ–Ω–µ—Ä–∞ –ú–∞—à—É...–∏ –¥–∞, —ç—Ç–æ –±—ã–ª–∏ –í—ã üòè",
      "–í–∞—Å —Ö–æ—Ç–µ–ª–∏ –∏–∑–º–∞–∑–∞—Ç—å –ø–∞—Å—Ç–æ–π, –Ω–æ –≤—ã –æ–∫–∞–∑–∞–ª–∏—Å—å –±—ã—Å—Ç—Ä–µ–µ!",
      "–¢—Ä–µ–Ω–µ—Ä—É –¢–∞–Ω–µ —Å–µ–≥–æ–¥–Ω—è –Ω–µ –ø–æ–≤–µ–∑–ª–æ! –ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ –≤–∏–¥–µ–ª, –≤—ã –∏–∑–º–∞–∑–∞–ª–∏ –µ–µ –ø–∞—Å—Ç–æ–π",
      "–í—ã –∏–∑–º–∞–∑–∞–ª–∏ –ø–∞—Å—Ç–æ–π –¥—Ä—É–≥–æ–≥–æ —à–∞–≥–∞—Ç–µ–ª—è!",
      "–í—ã –∏–∑–º–∞–∑–∞–ª–∏ –ø–∞—Å—Ç–æ–π –∑–µ—Ä–∫–∞–ª–æ –≤ –≤–∞–Ω–Ω–æ–π"
    ];
    const emojis=["üòÇ","üòú","üôà","ü§≠","ü•≥","ü§£"];
    let counter=0,record=0,round=1,explosionChance=0,firstExplosion=false,lastMessage="",confettiShown=false;

    function getRandomMessage(){
      let newMsg;
      do{newMsg=messages[Math.floor(Math.random()*messages.length)];}while(newMsg===lastMessage);
      lastMessage=newMsg;
      return newMsg;
    }
    function showEmoji(){
      const e=document.createElement("div");
      e.textContent=emojis[Math.floor(Math.random()*emojis.length)];
      e.className="emoji";
      e.style.left="50%"; e.style.bottom="50px";
      document.body.appendChild(e);
      setTimeout(()=>e.remove(),1200);
    }

    function handleTubeClick(){
      tube.classList.add("shake");
      setTimeout(()=>tube.classList.remove("shake"),300);

      if (tube.src.includes("intro.jpg")) {   // ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
        tube.src = "toothpaste.png";
        return; // –ø–µ—Ä–≤—ã–π –∫–ª–∏–∫ —Ç–æ–ª—å–∫–æ –º–µ–Ω—è–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫—É
      }

      if(counterEl.classList.contains("hidden")) counterEl.classList.remove("hidden");

      explosionChance+=0.15;

      if((!firstExplosion&&counter>=2)||(firstExplosion&&Math.random()<explosionChance)){
        startExplosion();
      } else {
        counter++;
        counterEl.textContent=`–ü—Ä–æ–∫–∞–∑—ã —Å –ø–∞—Å—Ç–æ–π: ${counter}`;

        if(round>1&&counter>record){
          record=counter;
          recordEl.textContent=`–†–µ–∫–æ—Ä–¥: ${record}`;
          if(recordEl.classList.contains("hidden")) recordEl.classList.remove("hidden");
          if(!confettiShown&&(record===5||record===10||record===15)){
            confettiShown=true;
            launchConfetti();
          }
        }

        if(Math.random()<0.3){showEmoji();messageEl.textContent="";} 
        else {messageEl.textContent=getRandomMessage();}
      }
    }

    function startExplosion(){
      firstExplosion=true; explosionChance=0; counter=0;
      counterEl.textContent=`–ü—Ä–æ–∫–∞–∑—ã —Å –ø–∞—Å—Ç–æ–π: ${counter}`;
      tube.style.display="none"; video.style.display="block";
      video.currentTime=0; video.play(); messageEl.textContent="";

      video.onended=()=>{
        pinkOverlay.classList.add("show");
        setTimeout(()=>{finalText.style.display="block";},500);
      };
    }

    resetBtn.addEventListener("click",()=>{
      round++; tube.style.display="block"; video.style.display="none";
      pinkOverlay.classList.remove("show"); finalText.style.display="none";
      messageEl.textContent=""; confettiShown=false;
    });

    tube.addEventListener("mousedown",e=>e.preventDefault());
    tube.addEventListener("click",handleTubeClick);

    function launchConfetti(){
      const end=Date.now()+1000;
      (function frame(){
        confetti({particleCount:5,angle:60,spread:55,origin:{x:0},colors:["#CF2C02","#FFBA08","#E85D04"]});
        confetti({particleCount:5,angle:120,spread:55,origin:{x:1},colors:["#CF2C02","#FFBA08","#E85D04"]});
        if(Date.now()<end) requestAnimationFrame(frame);
      })();
    }
  </script>
</body>
</html>
